<div id="execute-result">
  <div class="flash-{{ 'success' if success else 'error' }}">{{ message }}</div>

  {% if result %}
  {% set executions = result.executions or [] %}
  {% set success_count = executions | selectattr('status', 'equalto', 'success') | list | length %}
  {% set failed_count = executions | selectattr('status', 'equalto', 'failed') | list | length %}
  {% set skipped_count = result.skipped | length %}

  <p>
    <strong>성공:</strong> {{ success_count }} &nbsp;
    <strong>실패:</strong> {{ failed_count }} &nbsp;
    <strong>스킵:</strong> {{ skipped_count }}
  </p>

  {% if result.sync_warning %}
  <div class="flash-error">동기화 경고: {{ result.sync_warning }}</div>
  {% endif %}

  {% set failed_execs = executions | selectattr('status', 'equalto', 'failed') | list %}
  {% if failed_execs %}
  <h4>실패한 주문</h4>
  <table>
    <thead>
      <tr><th>Ticker</th><th>Action</th><th>msg_cd</th><th>msg1</th></tr>
    </thead>
    <tbody>
      {% for ex in failed_execs %}
      <tr>
        <td><code>{{ ex.intent.ticker }}</code></td>
        <td>{{ ex.intent.side }}</td>
        <td>{{ (ex.raw_response or {}).get('msg_cd', '') }}</td>
        <td>{{ (ex.raw_response or {}).get('msg1', '') }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% endif %}
  {% endif %}

  <p><a href="/rebalance">← 리밸런싱으로 돌아가기</a></p>
</div>
