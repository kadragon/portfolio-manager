{% extends "base.html" %}
{% block title %}Rebalance â€” Portfolio Manager{% endblock %}

{% block content %}
<h2>Rebalancing Recommendations</h2>

{% if error %}
<div class="flash-error">{{ error }}</div>
{% endif %}

{% if sell_recommendations %}
<h3>ğŸ”´ Sell</h3>
<div style="overflow-x:auto">
  <table>
    <thead>
      <tr>
        <th>Group</th>
        <th>Ticker</th>
        <th>Name</th>
        <th class="text-right">Amount</th>
        <th class="text-right">Quantity</th>
        <th>Currency</th>
      </tr>
    </thead>
    <tbody>
      {% for rec in sell_recommendations %}
      <tr>
        <td>{{ rec.group_name or "-" }}</td>
        <td><code>{{ rec.ticker }}</code></td>
        <td>{{ rec.stock_name or "-" }}</td>
        <td class="text-right negative">
          {% if rec.currency == "KRW" %}{{ rec.amount | format_krw }}{% else %}{{ rec.amount | format_usd }}{% endif %}
        </td>
        <td class="text-right">
          {% if rec.quantity is not none %}{{ rec.quantity | int }}{% else %}-{% endif %}
        </td>
        <td>{{ rec.currency or "-" }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endif %}

{% if buy_recommendations %}
<h3>ğŸŸ¢ Buy</h3>
<div style="overflow-x:auto">
  <table>
    <thead>
      <tr>
        <th>Group</th>
        <th>Ticker</th>
        <th>Name</th>
        <th class="text-right">Amount</th>
        <th class="text-right">Quantity</th>
        <th>Currency</th>
      </tr>
    </thead>
    <tbody>
      {% for rec in buy_recommendations %}
      <tr>
        <td>{{ rec.group_name or "-" }}</td>
        <td><code>{{ rec.ticker }}</code></td>
        <td>{{ rec.stock_name or "-" }}</td>
        <td class="text-right positive">
          {% if rec.currency == "KRW" %}{{ rec.amount | format_krw }}{% else %}{{ rec.amount | format_usd }}{% endif %}
        </td>
        <td class="text-right">
          {% if rec.quantity is not none %}{{ rec.quantity | int }}{% else %}-{% endif %}
        </td>
        <td>{{ rec.currency or "-" }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endif %}

{% if not sell_recommendations and not buy_recommendations and not error %}
<p>ë¦¬ë°¸ëŸ°ì‹± ì¶”ì²œì´ ì—†ìŠµë‹ˆë‹¤. í¬íŠ¸í´ë¦¬ì˜¤ê°€ ì´ë¯¸ ëª©í‘œ ë¹„ì¤‘ì— ë§ê²Œ êµ¬ì„±ë˜ì–´ ìˆìŠµë‹ˆë‹¤.</p>
{% endif %}

{% if (sell_recommendations or buy_recommendations) %}
<div id="execute-result">
  <form hx-post="/rebalance/execute"
        hx-target="#execute-result"
        hx-swap="outerHTML"
        hx-confirm="ì •ë§ ì£¼ë¬¸ì„ ì‹¤í–‰í•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì´ ì‘ì—…ì€ ì‹¤ì œ ì£¼ë¬¸ì„ ì „ì†¡í•©ë‹ˆë‹¤."
        style="margin-top:1.5rem">
    {% if has_order_client %}
    <button type="submit" class="contrast">
      ì£¼ë¬¸ ì‹¤í–‰ (Execute Orders)
    </button>
    {% else %}
    <button type="button" disabled title="KIS ì£¼ë¬¸ í´ë¼ì´ì–¸íŠ¸ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.">
      ì£¼ë¬¸ ì‹¤í–‰ ë¶ˆê°€ (KIS ë¯¸ì„¤ì •)
    </button>
    {% endif %}
  </form>
</div>
{% endif %}

<p style="margin-top:2rem">
  <a href="/rebalance">â†» ìƒˆë¡œê³ ì¹¨</a>
</p>
{% endblock %}
